[![Tests](https://github.com/tuntun114514/python_unittest_learning/actions/workflows/python-test.yml/badge.svg)](https://github.com/tuntun114514/python_unittest_learning/actions)
[![Coverage](https://img.shields.io/badge/coverage-96%25-brightgreen)](./)
[![License](https://img.shields.io/badge/license-MIT-blue)](./LICENSE)

# File Processor - æ™ºèƒ½æ–‡ä»¶æ‰¹å¤„ç†å·¥å…·

æœ¬é¡¹ç›®ä»å­¦ä¹  Python unittest èµ·æ­¥ï¼Œé€æ­¥æ¼”è¿›ä¸ºåŠŸèƒ½å®Œæ•´çš„æ–‡ä»¶æ‰¹å¤„ç†å·¥å…·ï¼Œæ¶µç›–é…ç½®ç®¡ç†ã€æ–‡ä»¶è¿‡æ»¤ã€æ‰¹é‡é‡å‘½åç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œé…å¥—å®Œæ•´çš„è‡ªåŠ¨åŒ–æµ‹è¯•ä½“ç³»ï¼ˆ10 ä¸ªæµ‹è¯•ï¼Œè¦†ç›–ç‡ 96%ï¼‰ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

- âœ… **YAML é…ç½®ç®¡ç†**ï¼šæ”¯æŒå¤–éƒ¨é…ç½®æ–‡ä»¶
- âœ… **æ–‡ä»¶è¿‡æ»¤**ï¼šæŒ‰å¤§å°ç­›é€‰ï¼ˆMock æµ‹è¯•ï¼‰
- âœ… **æ‰¹é‡é‡å‘½å**ï¼šæ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢ã€è‡ªåŠ¨æ·»åŠ åºå·
- âœ… **dry_run æ¨¡å¼**ï¼šå…ˆé¢„è§ˆå†æ‰§è¡Œï¼Œé˜²æ­¢è¯¯æ“ä½œ
- âœ… **CLI å·¥å…·**ï¼šå‘½ä»¤è¡Œç›´æ¥è°ƒç”¨
- âœ… **è‡ªåŠ¨åŒ–æµ‹è¯•**ï¼š10 ä¸ªæµ‹è¯•ï¼ŒGitHub Actions CI/CD
- âœ… **è¦†ç›–ç‡ 96%**ï¼šè¶…è¿‡è¡Œä¸šä¼˜ç§€æ ‡å‡†ï¼ˆ80%ï¼‰

## ğŸ“¦ å®‰è£…

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/tuntun114514/python_unittest_learning.git
cd python_unittest_learning

# å®‰è£…ä¾èµ–
pip install pyyaml

# æœ¬åœ°å®‰è£…ï¼ˆå¯é€‰ï¼‰
pip install -e .

```

- [x] **Day 1: é¡¹ç›®åˆå§‹åŒ–ä¸é…ç½®ç®¡ç†**
  - å®ç° `Config` ç±»ï¼šYAML é…ç½®æ–‡ä»¶è¯»å–ä¸éªŒè¯
  - æŒæ¡ `assertEqual`, `assertRaises` æ–­è¨€
  - æŒæ¡ `tempfile` ä¸´æ—¶æ–‡ä»¶éš”ç¦»æµ‹è¯•
  - ç¼–å†™ 3 ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œå…¨éƒ¨é€šè¿‡


## Day 2: é‡æ„ä¸è¸©å‘è®°å½•ï¼ˆ2026/1/30ï¼‰

### ä»Šæ—¥å®Œæˆ
- [x] **é‡æ„ test_config.py**ï¼šä½¿ç”¨ `setUp`/`tearDown` æ¶ˆé™¤é‡å¤ä»£ç 
  - æŒæ¡ Fixture ç”Ÿå‘½å‘¨æœŸï¼šæ¯ä¸ªæµ‹è¯•å‰è‡ªåŠ¨åˆ›å»ºèµ„æºï¼Œæµ‹è¯•åè‡ªåŠ¨æ¸…ç†
  - ä»£ç è¡Œæ•°å‡å°‘ 30%ï¼Œå¯è¯»æ€§æ˜¾è‘—æå‡
  - è§£å†³ Windows æ–‡ä»¶é”å®šå¯¼è‡´çš„ `PermissionError`

- [x] **å­¦ä¹  Mock æµ‹è¯•åŸºç¡€**ï¼šç†è§£æµ‹è¯•æ›¿èº«ï¼ˆTest Doubleï¼‰æ¦‚å¿µ
  - æŒæ¡ `@patch` è£…é¥°å™¨éš”ç¦»å¤–éƒ¨ä¾èµ–ï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰
  - å®ç° `FileFilter` æ–‡ä»¶è¿‡æ»¤å™¨ï¼ˆæŒ‰å¤§å°è¿‡æ»¤ï¼Œæ— éœ€åˆ›å»ºçœŸå®å¤§æ–‡ä»¶ï¼‰

### å…³é”®æŠ€æœ¯ç‚¹

#### 1. setUp/tearDown ç”Ÿå‘½å‘¨æœŸï¼ˆFixtureï¼‰
setUp() â†’ test_xxx() â†’ tearDown() â†’ [ä¸‹ä¸€ä¸ªæµ‹è¯•å¾ªç¯]
- **æ‰§è¡Œä¿è¯**ï¼šæ— è®ºæµ‹è¯•é€šè¿‡ä¸å¦ï¼Œ`tearDown` **ä¸€å®šä¼šæ‰§è¡Œ**ï¼ˆç¡®ä¿èµ„æºé‡Šæ”¾ï¼Œç±»ä¼¼ try-finallyï¼‰
- **æµ‹è¯•éš”ç¦»**ï¼šæ¯ä¸ªæµ‹è¯•ç‹¬äº«å…¨æ–°çš„ `setUp` å®ä¾‹ï¼Œæµ‹è¯• A çš„è„æ•°æ®ä¸ä¼šæ±¡æŸ“æµ‹è¯• B
- **DRY åŸåˆ™**ï¼šæŠŠé‡å¤çš„ä¸´æ—¶æ–‡ä»¶åˆ›å»º/æ¸…ç†é€»è¾‘æŠ½å‡ºï¼Œæµ‹è¯•æ–¹æ³•åªå…³æ³¨ä¸šåŠ¡æ–­è¨€

#### 2. Windows æ–‡ä»¶é”å®šé™·é˜±ï¼ˆWinError 32ï¼‰
**é—®é¢˜ç°è±¡**ï¼š
PermissionError: [WinError 32] å¦ä¸€ä¸ªç¨‹åºæ­£åœ¨ä½¿ç”¨æ­¤æ–‡ä»¶ï¼Œè¿›ç¨‹æ— æ³•è®¿é—®

**æ ¹æœ¬åŸå› **ï¼šWindows å¯¹æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„æœ‰ä¸¥æ ¼é”å®šæœºåˆ¶ã€‚`NamedTemporaryFile` å³ä½¿è°ƒç”¨ `close()`ï¼Œå¥æŸ„é‡Šæ”¾ä¹Ÿå¯èƒ½å»¶è¿Ÿå‡ æ¯«ç§’ï¼Œå¯¼è‡´ `tearDown` ä¸­ `os.unlink()` å¤±è´¥ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨ `mkstemp()` åˆ›å»ºç©ºæ–‡ä»¶åç«‹å³ `os.close(fd)`ï¼Œåªä¿ç•™çº¯è·¯å¾„ï¼Œä¸ä¿æŒæ–‡ä»¶æ‰“å¼€
- å„æµ‹è¯•æ–¹æ³•åœ¨éœ€è¦å†™å…¥æ—¶è‡ªè¡Œ `open()`ï¼Œåˆ©ç”¨ `with` è¯­å¥ç¡®ä¿å…³é—­åå†åˆ é™¤

**ä»£ç å¯¹æ¯”**ï¼š

**é‡æ„å‰ï¼ˆå†—ä½™ï¼Œä¸” Windows ä¸‹ä¼šæŠ¥é”™ï¼‰**ï¼š
```python
def test_xxx(self):
    with tempfile.NamedTemporaryFile(...) as f:
        # æµ‹è¯•é€»è¾‘
        try:
            # ...
        finally:
            os.unlink(f.name)  # æ¯ä¸ªæµ‹è¯•éƒ½é‡å¤å†™ï¼Œä¸”å¥æŸ„æœªå®Œå…¨é‡Šæ”¾
```
**é‡æ„åï¼ˆå¥å£®ï¼Œè·¨å¹³å°å…¼å®¹ï¼‰**ï¼š

```python 
def setUp(self):
    fd, self.temp_path = tempfile.mkstemp(suffix='.yaml')
    os.close(fd)  # å…³é”®ï¼šç«‹å³é‡Šæ”¾ Windows å¥æŸ„

def tearDown(self):
    if os.path.exists(self.temp_path):
        os.unlink(self.temp_path)  # ç°åœ¨å¯ä»¥å®‰å…¨åˆ é™¤

def test_xxx(self):
    with open(self.temp_path, 'w') as f:
        # åªå†™ä¸šåŠ¡é€»è¾‘ï¼Œä¸æ“å¿ƒèµ„æºæ¸…ç†
```


### 3. Mock æµ‹è¯•å®æˆ˜

**ä¸ºä»€ä¹ˆè¦ Mockï¼Ÿ**  
æµ‹è¯•"è¿‡æ»¤å¤§äº 1GB çš„æ–‡ä»¶"æ—¶ï¼Œä¸éœ€è¦çœŸçš„åˆ›å»º 1GB æ–‡ä»¶ï¼š
- èŠ‚çœæ—¶é—´å’Œç£ç›˜ç©ºé—´
- æµ‹è¯•æ›´ç¨³å®šï¼ˆä¸ä¾èµ–çœŸå®æ–‡ä»¶ç³»ç»Ÿï¼‰
- å¯ä»¥æ¨¡æ‹Ÿæç«¯æƒ…å†µï¼ˆå¦‚ç£ç›˜é”™è¯¯ï¼‰

æ ¸å¿ƒæŠ€å·§ï¼š
```Python
@patch('file_processor.filters.os.path.getsize')
@patch.object(Path, 'exists', return_value=True)
def test_filter_by_size(self, mock_exists, mock_getsize):
  mock_getsize.return_value = 500  # å‡è£…æ–‡ä»¶ 500 å­—èŠ‚
```    
###æµ‹è¯•é€»è¾‘
**å…³é”®æ¦‚å¿µ**ï¼š
- `@patch`ï¼šæŠŠç›®æ ‡å‡½æ•°æ›¿æ¢ä¸º Mock å¯¹è±¡
- `return_value`ï¼šè®¾å®šå‡è¿”å›å€¼  
- `assert_called_once_with`ï¼šéªŒè¯å‡½æ•°ç¡®å®è¢«è°ƒç”¨ï¼ˆç¡®ä¿é€»è¾‘è¦†ç›–ï¼‰


#### 4. æµ‹è¯•è¦†ç›–æƒ…å†µ

- `test_config.py`: 3/3 æµ‹è¯•é€šè¿‡ï¼ˆFixture é‡æ„ï¼‰
- `test_filters.py`: 3/3 æµ‹è¯•é€šè¿‡ï¼ˆå« 2 ä¸ª Mock æµ‹è¯•ï¼‰
  - `test_nonexistent_file`ï¼šçœŸå®æµ‹è¯•ï¼ŒéªŒè¯æ–‡ä»¶ä¸å­˜åœ¨é€»è¾‘
  - `test_filter_by_size`ï¼šMock æµ‹è¯•ï¼ŒéªŒè¯å°æ–‡ä»¶è¢«è¿‡æ»¤
  - `test_large_file_pass`ï¼šMock æµ‹è¯•ï¼ŒéªŒè¯å¤§æ–‡ä»¶é€šè¿‡

**ä¸‹ä¸€æ­¥è®¡åˆ’ï¼ˆDay 3ï¼‰**
- [ ] **GitHub Actions CI/CD**ï¼šé…ç½®è‡ªåŠ¨æµ‹è¯•æµæ°´çº¿
- [ ] **æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š**ï¼šä½¿ç”¨ coverage.py ç”Ÿæˆå¯è§†åŒ–æŠ¥å‘Š
- [ ] **æ‰¹é‡é‡å‘½ååŠŸèƒ½**ï¼šå®ç°å®Œæ•´çš„æ–‡ä»¶æ‰¹å¤„ç†é€»è¾‘ï¼ˆé›†æˆæµ‹è¯•ï¼‰

##å®Œæˆåçš„æ€»æµ‹è¯•
è¿è¡Œå…¨éƒ¨æµ‹è¯•ï¼Œç¡®è®¤ 6/6 é€šè¿‡ï¼š
```
bash
python -m unittest discover -v
```
è¾“å‡ºç»“æœï¼š
```
test_file_not_exists ... ok
test_missing_version ... ok
test_valid_config ... ok
test_filter_by_size ... ok
test_large_file_pass ... ok
test_nonexistent_file ... ok
----------------------------------------------------------------------
Ran 6 tests in 0.015s
```

## Day 3: CI/CD è‡ªåŠ¨åŒ–æµ‹è¯•ï¼ˆ2026/1/31ï¼‰

### ä»Šæ—¥å®Œæˆ
- [x] **é…ç½® GitHub Actions**ï¼šå®ç°è‡ªåŠ¨åŒ–æµ‹è¯•æµæ°´çº¿
  - æ¯æ¬¡ push/pull_request è‡ªåŠ¨è§¦å‘æµ‹è¯•
  - ä½¿ç”¨ Ubuntu ç¯å¢ƒ + Python 3.12
  - 6 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ âœ…ï¼ˆ10 ç§’å†…å®Œæˆï¼‰

### å…³é”®æŠ€æœ¯ç‚¹

#### GitHub Actions å·¥ä½œæµé…ç½®
```yaml
# .github/workflows/python-test.yml
name: Python Tests
on: [push, pull_request]  # è§¦å‘æ¡ä»¶ï¼šæ¨é€æˆ–æ PR æ—¶è‡ªåŠ¨è¿è¡Œ
jobs:
  test:
    runs-on: ubuntu-latest  # è¿è¡Œç¯å¢ƒï¼šäº‘ç«¯ Linux è™šæ‹Ÿæœº
    steps:
      - uses: actions/checkout@v4      # æ‹‰å–ä»£ç 
      - uses: actions/setup-python@v5  # å®‰è£… Python 3.12
      - run: pip install pyyaml        # å®‰è£…ä¾èµ–
      - run: python -m unittest discover -v  # æ‰§è¡Œæµ‹è¯•

OK
```

## Day 4: æ‰¹é‡é‡å‘½åä¸é›†æˆæµ‹è¯•ï¼ˆ2026/2/2ï¼‰

### ä»Šæ—¥å®Œæˆ
- [x] **å®ç° Renamer ç±»**ï¼šå®Œæˆæ–‡ä»¶æ‰¹å¤„ç†æ ¸å¿ƒåŠŸèƒ½
  - `rename_with_pattern()`ï¼šæ­£åˆ™è¡¨è¾¾å¼æ‰¹é‡æ›¿æ¢ï¼ˆå¦‚ `report_2024.txt` â†’ `year_2024_report.txt`ï¼‰
  - `add_sequence()`ï¼šè‡ªåŠ¨æ·»åŠ åºå·ï¼ˆ001, 002, 003...ï¼‰
  - `dry_run` æ¨¡å¼ï¼šåªé¢„è§ˆä¸æ‰§è¡Œï¼Œé˜²æ­¢è¯¯æ“ä½œï¼ˆ"é˜²æ‰‹æŠ–"è®¾è®¡ï¼‰
- [x] **é›†æˆæµ‹è¯•**ï¼ˆIntegration Testï¼‰ï¼šä½¿ç”¨çœŸå®ä¸´æ—¶ç›®å½•æ“ä½œçœŸå®æ–‡ä»¶
  - ä¸å†ä½¿ç”¨ Mockï¼ŒéªŒè¯çœŸå®æ–‡ä»¶ç³»ç»Ÿäº¤äº’ï¼ˆåˆ›å»º â†’ é‡å‘½å â†’ å†…å®¹éªŒè¯ï¼‰
  - ä½¿ç”¨ `tempfile.TemporaryDirectory()` å®ç°æµ‹è¯•éš”ç¦»
- [x] **æµ‹è¯•è°ƒè¯•æŠ€å·§**ï¼šæŒæ¡æ’æŸ¥æµ‹è¯•å¤±è´¥çš„æ–¹æ³•ï¼ˆæ‰“å°è°ƒè¯•ã€reprã€æ–­è¨€ä¿¡æ¯å®Œå–„ï¼‰

### å…³é”®æŠ€æœ¯ç‚¹

#### 1. é›†æˆæµ‹è¯• vs Mock æµ‹è¯•å¯¹æ¯”

| æµ‹è¯•ç±»å‹ | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ | æœ¬æ—¥ç¤ºä¾‹ |
|---------|---------|------|------|---------|
| **Mock æµ‹è¯•** | éš”ç¦»å¤–éƒ¨ä¾èµ– | å¿«é€Ÿã€ä¸ä¾èµ–ç¯å¢ƒã€å®‰å…¨ | ä¸éªŒè¯çœŸå®äº¤äº’ | Day 2 çš„ FileFilterï¼ˆå‡è£…æ–‡ä»¶å¤§å°ï¼‰ |
| **é›†æˆæµ‹è¯•** | éªŒè¯çœŸå®è¡Œä¸º | éªŒè¯å®Œæ•´æµç¨‹ã€å‘ç°ç¯å¢ƒç›¸å…³é—®é¢˜ | æ…¢ã€éœ€è¦æ¸…ç†èµ„æº | ä»Šå¤©çš„ Renamerï¼ˆçœŸçš„åˆ›å»ºå¹¶é‡å‘½åæ–‡ä»¶ï¼‰ |

#### 2. dry_run æ¨¡å¼ï¼ˆé˜²å¾¡æ€§ç¼–ç¨‹ï¼‰
è¿™æ˜¯ç”Ÿäº§ç¯å¢ƒå¸¸ç”¨çš„å®‰å…¨è®¾è®¡ï¼š
```python
renamer = Renamer(dry_run=True)   # å…ˆé¢„è§ˆï¼Œçœ‹çœ‹ä¼šæ”¹å“ªäº›æ–‡ä»¶
preview = renamer.rename_with_pattern(...)  
print(preview)  # ['report_2024.txt -&gt; year_2024_report.txt', ...]

# ç¡®è®¤æ— è¯¯åå†æ‰§è¡Œ
renamer = Renamer(dry_run=False)  
renamer.rename_with_pattern(...)  # çœŸæ­£ä¿®æ”¹

## é¡¹ç›®å®Œç»“ï¼ˆDay 5-7ï¼‰
### ä»Šæ—¥å®Œæˆ
- [x] **æµ‹è¯•è¦†ç›–ç‡ 96%**ï¼šä½¿ç”¨ coverage.py ç”ŸæˆæŠ¥å‘Šï¼Œè¶…è¿‡ 80% ä¼˜ç§€æ ‡å‡†
- [x] **CLI å·¥å…·**ï¼šåˆ›å»º cli.pyï¼Œæ”¯æŒå‘½ä»¤è¡Œ `python cli.py ç›®å½• --pattern xxx --replace yyy --dry-run`
- [x] **æ‰“åŒ…å‘å¸ƒ**ï¼šsetup.py æ”¯æŒ `pip install -e .` æœ¬åœ°å®‰è£…

### ä½¿ç”¨ç¤ºä¾‹
```bash
# å‘½ä»¤è¡Œ
python cli.py ./æ–‡ä»¶å¤¹ --pattern "test_(\\d+)" --replace "backup_\\1" --dry-run

# æœ¬åœ°å®‰è£…å
pip install -e .
file-processor ./æ–‡ä»¶å¤¹ --pattern "test" --replace "backup"

